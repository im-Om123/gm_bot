<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Chatbot UI</title>
    <!-- Tailwind CSS for modern styling and responsiveness -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for the chat window */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background-color: #cbd5e1; /* gray-300 */
            border-radius: 4px;
        }

        /* Fade-in animation for the chat window */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .chat-window {
            animation: fadeIn 0.2s ease-out;
        }

        /* Bot icon animation */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .bot-icon-minimized {
            animation: bounce 1s infinite;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Main Chatbot Container (fixed to bottom-right) -->
    <div class="fixed bottom-4 right-4 z-50 flex flex-col items-end">

        <!-- 1. The Minimized Chatbot Button -->
        <button id="chat-button" class="bot-icon-minimized bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-blue-300">
            <!-- Bot icon, you can use an SVG or image -->
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
            </svg>
        </button>

        <!-- 2. The Expanded Chatbot Window (hidden by default) -->
        <div id="chat-window" class="chat-window hidden w-full max-w-sm h-96 sm:w-80 bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col mt-4">

            <!-- Chat Header -->
            <div class="bg-blue-600 text-white p-4 flex items-center justify-between rounded-t-xl">
                <div class="flex items-center">
                    <!-- Bot icon in header -->
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                    </svg>
                    <span class="font-semibold text-lg">GharBahal Bot</span>
                </div>
                <button id="close-chat" class="p-1 rounded-full hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Chat Messages Container -->
            <div id="chat-messages" class="chat-messages flex-1 p-4 overflow-y-auto space-y-4 text-sm">
                <!-- Initial bot message -->
                <div class="flex justify-start">
                    <div class="bg-gray-200 text-gray-800 p-3 rounded-xl rounded-bl-none max-w-[80%] shadow">
                        Hello! I am the GharBahal assistant. How can I help you today?
                    </div>
                </div>
            </div>

            <!-- Chat Input Form -->
            <form id="chat-form" class="bg-gray-100 p-4 border-t border-gray-300">
                <div class="flex items-center">
                    <input type="text" id="chat-input" placeholder="Send a message..." class="flex-1 border border-gray-400 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 mr-2 transition-all duration-200">
                    <button type="submit" class="bg-blue-600 text-white p-3 rounded-full hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-300">
                        <!-- Send icon -->
                        <svg class="w-5 h-5 transform rotate-90" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 00.149 1.485.5.5 0 00.106.059.5.5 0 00.322-.093l.334-.145a1 1 0 00.865-.125l5.127-3.418a1 1 0 00.41-.659v-3.834a1 1 0 00-2 0v3.834a1 1 0 00.41.659l1.196.797a.5.5 0 01.127.086c.036.03.076.05.116.06a.5.5 0 01.127.018a.5.5 0 01.218-.16l5.127-3.418a1 1 0 00.865-.125.5.5 0 00.322.093.5.5 0 00.106-.059 1 1 0 00.149-1.485l-7-14z"></path>
                        </svg>
                    </button>
                </div>
            </form>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatButton = document.getElementById('chat-button');
            const chatWindow = document.getElementById('chat-window');
            const closeChatButton = document.getElementById('close-chat');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const chatMessagesContainer = document.getElementById('chat-messages');

            // Helper function to append a message to the chat container
            const appendMessage = (text, sender) => {
                const messageDiv = document.createElement('div');
                const bubbleDiv = document.createElement('div');
                
                if (sender === 'user') {
                    messageDiv.className = 'flex justify-end';
                    bubbleDiv.className = 'bg-blue-600 text-white p-3 rounded-xl rounded-br-none max-w-[80%] shadow';
                } else if (sender === 'bot') {
                    messageDiv.className = 'flex justify-start';
                    bubbleDiv.className = 'bg-gray-200 text-gray-800 p-3 rounded-xl rounded-bl-none max-w-[80%] shadow';
                } else if (sender === 'loading') {
                    messageDiv.className = 'flex justify-start';
                    bubbleDiv.className = 'bg-gray-200 text-gray-800 p-3 rounded-xl rounded-bl-none shadow animate-pulse';
                    bubbleDiv.textContent = '...';
                }
                
                bubbleDiv.textContent = text;
                messageDiv.appendChild(bubbleDiv);
                chatMessagesContainer.appendChild(messageDiv);
                
                // Scroll to the bottom
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
            };

            // Toggle the chat window's visibility
            chatButton.addEventListener('click', () => {
                chatWindow.classList.toggle('hidden');
            });

            // Close the chat window
            closeChatButton.addEventListener('click', () => {
                chatWindow.classList.add('hidden');
            });

            // Handle sending a message
            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userMessage = chatInput.value.trim();
                
                if (userMessage) {
                    // Display user message
                    appendMessage(userMessage, 'user');
                    chatInput.value = '';
                    
                    // Display loading indicator
                    const loadingIndicator = document.createElement('div');
                    loadingIndicator.className = 'flex justify-start';
                    loadingIndicator.innerHTML = '<div class="bg-gray-200 p-3 rounded-xl rounded-bl-none shadow animate-pulse w-10 h-10 flex items-center justify-center"><div class="dots"></div></div>';
                    chatMessagesContainer.appendChild(loadingIndicator);
                    
                    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;

                    try {
                        // Send the message to the Flask backend
                        const response = await fetch('/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ message: userMessage }),
                        });
                        
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        
                        const data = await response.json();
                        
                        // Remove loading indicator
                        loadingIndicator.remove();
                        
                        // Display the bot's response
                        appendMessage(data.response, 'bot');

                    } catch (error) {
                        console.error('Error fetching bot response:', error);
                        // Remove loading indicator and show an error message
                        loadingIndicator.remove();
                        appendMessage('Sorry, something went wrong. Please try again.', 'bot');
                    }
                }
            });
        });
    </script>

</body>
</html>
